<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 任務派遣中心 - 語音輸入版</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .main-content {
            padding: 30px;
        }
        
        .voice-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .voice-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }
        
        .voice-card:hover {
            border-color: #4facfe;
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.2);
        }
        
        .voice-card h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .voice-input {
            background: #fff;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            min-height: 200px;
            font-size: 16px;
            resize: vertical;
            transition: border-color 0.3s ease;
        }
        
        .voice-input:focus {
            outline: none;
            border-color: #4facfe;
        }
        
        .button {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.4);
        }
        
        .button:active {
            transform: translateY(0);
        }
        
        .button.recording {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
        }
        
        .button.processing {
            background: linear-gradient(135deg, #ffa726 0%, #ff9800 100%);
        }
        
        .timer {
            font-size: 2em;
            font-weight: bold;
            color: #ff6b6b;
            text-align: center;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
        }
        
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 500;
        }
        
        .status.recording {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #ffcdd2;
        }
        
        .status.processing {
            background: #fff3e0;
            color: #ef6c00;
            border: 1px solid #ffcc02;
        }
        
        .status.ready {
            background: #e8f5e8;
            color: #2e7d32;
            border: 1px solid #c8e6c9;
        }
        
        .file-list {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: white;
            border-radius: 5px;
            margin: 5px 0;
            border: 1px solid #e9ecef;
        }
        
        .file-info {
            flex: 1;
        }
        
        .file-name {
            font-weight: 600;
            color: #333;
        }
        
        .file-details {
            font-size: 0.9em;
            color: #666;
            margin-top: 2px;
        }
        
        .file-actions {
            display: flex;
            gap: 5px;
        }
        
        .btn-small {
            padding: 5px 10px;
            font-size: 12px;
            border-radius: 15px;
        }
        
        .transcription-result {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            min-height: 200px;
        }
        
        .transcription-text {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            min-height: 150px;
            font-size: 16px;
            line-height: 1.6;
            white-space: pre-wrap;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .pulse {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .hidden {
            display: none;
        }
        
        /* 輸入方式選擇樣式 */
        .input-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .tab-button {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            color: #666;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .tab-button:hover {
            border-color: #4facfe;
            color: #4facfe;
        }
        
        .tab-button.active {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            border-color: #4facfe;
            color: white;
        }
        
        .input-section {
            display: none;
        }
        
        .input-section.active {
            display: block;
        }
        
        /* 上傳區域樣式 */
        .upload-area, .screenshot-area {
            border: 2px dashed #ddd;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            transition: all 0.3s ease;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .upload-area:hover, .screenshot-area:hover {
            border-color: #4facfe;
            background: #f8f9ff;
        }
        
        .upload-placeholder, .screenshot-placeholder {
            text-align: center;
        }
        
        .uploaded-files, .cloud-preview {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: white;
            border-radius: 5px;
            margin: 5px 0;
            border: 1px solid #e9ecef;
        }
        
        .cloud-url-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 15px;
        }
        
        .cloud-url-input:focus {
            outline: none;
            border-color: #4facfe;
        }
        
        .screenshot-preview {
            text-align: center;
        }
        
        /* 任務派遣與通知樣式 */
        .dispatch-section {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid #e9ecef;
        }
        
        .dispatch-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .backend-status {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        
        .status-item {
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            border-left: 4px solid #4facfe;
            background: #f8f9ff;
        }
        
        .notification-settings {
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        
        .assignee-list {
            margin: 15px 0;
        }
        
        .assignee-item {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            padding: 10px;
            margin: 10px 0;
            background: #f8f9fa;
            border-radius: 5px;
            align-items: center;
        }
        
        .assignee-item label {
            font-weight: 600;
            color: #333;
        }
        
        .assignee-item input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .assignee-item input:focus {
            outline: none;
            border-color: #4facfe;
        }
        
        @media (max-width: 768px) {
            .voice-section {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .input-tabs {
                flex-direction: column;
                align-items: center;
            }
            
            .tab-button {
                width: 100%;
                max-width: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎤 AI 任務派遣中心</h1>
            <p>智能語音輸入與任務分析系統</p>
        </div>
        
        <div class="main-content">
            <!-- 多種輸入方式 -->
            <div class="input-methods">
                <h2 style="text-align: center; margin-bottom: 30px; color: #333;">📝 多種輸入方式</h2>
                
                <!-- 輸入方式選擇 -->
                <div class="input-tabs">
                    <button class="tab-button active" onclick="switchInputMethod('voice')">🎤 語音輸入</button>
                    <button class="tab-button" onclick="switchInputMethod('manual')">⌨️ 手動輸入</button>
                    <button class="tab-button" onclick="switchInputMethod('screenshot')">📸 螢幕截圖</button>
                    <button class="tab-button" onclick="switchInputMethod('upload')">📁 上傳檔案</button>
                    <button class="tab-button" onclick="switchInputMethod('cloud')">☁️ 雲端檔案</button>
                    <button class="tab-button" onclick="switchInputMethod('text')">📄 文字貼文</button>
                </div>
                
                <!-- 語音輸入區域 -->
                <div id="voice-input" class="input-section active">
                    <div class="voice-section">
                        <!-- 即時語音輸入 -->
                        <div class="voice-card">
                            <h3>🎙️ 即時語音輸入</h3>
                            <div id="voiceStatus" class="status ready">準備就緒 - 點擊開始語音輸入</div>
                            <div class="controls">
                                <button id="startVoiceBtn" class="button" onclick="startVoiceInput()">
                                    🎤 開始語音輸入
                                </button>
                                <button id="stopVoiceBtn" class="button hidden" onclick="stopVoiceInput()">
                                    ⏹️ 停止語音輸入
                                </button>
                                <button id="useVoiceTextBtn" class="button hidden" onclick="useVoiceText()">
                                    ✅ 使用此文字
                                </button>
                            </div>
                            <textarea id="voiceInput" class="voice-input" placeholder="語音輸入結果將顯示在此處..."></textarea>
                        </div>
                        
                        <!-- 錄音功能 -->
                        <div class="voice-card">
                            <h3>🎙️ 錄音功能</h3>
                            <div id="recordingStatus" class="status ready">準備錄音</div>
                            <div id="timer" class="timer hidden">00:00</div>
                            
                            <!-- 錄音控制按鍵 -->
                            <div class="controls">
                                <button id="startRecordBtn" class="button" onclick="startRecording()">
                                    ⏺️ 開始錄音
                                </button>
                                <button id="pauseRecordBtn" class="button hidden" onclick="pauseRecording()">
                                    ⏸️ 暫停錄音
                                </button>
                                <button id="resumeRecordBtn" class="button hidden" onclick="resumeRecording()">
                                    ▶️ 繼續錄音
                                </button>
                                <button id="stopRecordBtn" class="button hidden" onclick="stopRecording()">
                                    ⏹️ 停止錄音
                                </button>
                            </div>
                            
                            <!-- 錄音檔案列表 -->
                            <div id="fileList" class="file-list hidden">
                                <h4>📁 錄音檔案</h4>
                                <div id="filesContainer"></div>
                                <div class="controls">
                                    <button class="button btn-small" onclick="selectAllFiles()">全選</button>
                                    <button class="button btn-small" onclick="clearSelection()">清除選擇</button>
                                    <button class="button btn-small" onclick="transcribeSelected()">轉逐字稿</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 手動輸入區域 -->
                <div id="manual-input" class="input-section">
                    <div class="voice-card">
                        <h3>⌨️ 手動輸入</h3>
                        <textarea id="manualInput" class="voice-input" placeholder="請在此輸入您的任務描述..."></textarea>
                        <div class="controls">
                            <button class="button" onclick="processManualInput()">📝 分析任務</button>
                            <button class="button" onclick="clearManualInput()">🗑️ 清除</button>
                        </div>
                    </div>
                </div>
                
                <!-- 螢幕截圖區域 -->
                <div id="screenshot-input" class="input-section">
                    <div class="voice-card">
                        <h3>📸 螢幕截圖</h3>
                        <div class="status info">點擊下方按鈕開始螢幕截圖，或拖拽圖片到此區域</div>
                        <div id="screenshotArea" class="screenshot-area" ondrop="handleScreenshotDrop(event)" ondragover="handleDragOver(event)">
                            <div id="screenshotPreview" class="screenshot-preview hidden">
                                <img id="screenshotImage" style="max-width: 100%; max-height: 300px; border-radius: 5px;">
                                <div class="controls">
                                    <button class="button" onclick="analyzeScreenshot()">🔍 分析截圖</button>
                                    <button class="button" onclick="clearScreenshot()">🗑️ 清除</button>
                                </div>
                            </div>
                            <div id="screenshotPlaceholder" class="screenshot-placeholder">
                                <p>📸 點擊按鈕開始截圖或拖拽圖片到此處</p>
                                <button class="button" onclick="startScreenshot()">📸 開始截圖</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 檔案上傳區域 -->
                <div id="upload-input" class="input-section">
                    <div class="voice-card">
                        <h3>📁 上傳檔案</h3>
                        <div class="status info">支援 Word、PDF、JSON、Markdown 檔案</div>
                        <div id="uploadArea" class="upload-area" ondrop="handleFileDrop(event)" ondragover="handleDragOver(event)">
                            <input type="file" id="fileInput" accept=".doc,.docx,.pdf,.json,.md,.txt" multiple style="display: none;" onchange="handleFileSelect(event)">
                            <div id="uploadPlaceholder" class="upload-placeholder">
                                <p>📁 點擊選擇檔案或拖拽到此處</p>
                                <button class="button" onclick="document.getElementById('fileInput').click()">📁 選擇檔案</button>
                            </div>
                            <div id="uploadedFiles" class="uploaded-files hidden">
                                <h4>已上傳檔案</h4>
                                <div id="filesList"></div>
                                <div class="controls">
                                    <button class="button" onclick="analyzeUploadedFiles()">📝 分析檔案</button>
                                    <button class="button" onclick="clearUploadedFiles()">🗑️ 清除</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 雲端檔案區域 -->
                <div id="cloud-input" class="input-section">
                    <div class="voice-card">
                        <h3>☁️ 雲端檔案</h3>
                        <div class="status info">連接 Google Docs 或其他雲端服務</div>
                        <div class="cloud-input-area">
                            <input type="url" id="cloudUrl" class="cloud-url-input" placeholder="請輸入 Google Docs 或其他雲端檔案連結...">
                            <div class="controls">
                                <button class="button" onclick="fetchCloudDocument()">☁️ 載入雲端檔案</button>
                                <button class="button" onclick="clearCloudInput()">🗑️ 清除</button>
                            </div>
                            <div id="cloudPreview" class="cloud-preview hidden">
                                <h4>雲端檔案預覽</h4>
                                <div id="cloudContent"></div>
                                <div class="controls">
                                    <button class="button" onclick="analyzeCloudDocument()">📝 分析雲端檔案</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 文字貼文區域 -->
                <div id="text-input" class="input-section">
                    <div class="voice-card">
                        <h3>📄 文字貼文</h3>
                        <div class="status info">貼上任何文字內容進行分析</div>
                        <textarea id="textInput" class="voice-input" placeholder="請貼上文字內容..."></textarea>
                        <div class="controls">
                            <button class="button" onclick="processTextInput()">📝 分析文字</button>
                            <button class="button" onclick="clearTextInput()">🗑️ 清除</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 轉逐字稿視窗 -->
            <div id="transcriptionSection" class="transcription-result hidden">
                <h3>📝 轉逐字稿結果</h3>
                <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 5px; padding: 10px; margin-bottom: 15px;">
                    <strong>💡 提示：</strong> 轉逐字稿功能會將選中的錄音檔案轉換為文字內容，您可以使用這些文字進行任務分析。
                </div>
                <div id="transcriptionText" class="transcription-text">轉逐字稿結果將顯示在此處...</div>
                <div class="controls">
                    <button class="button" onclick="useTranscription()">✅ 使用此逐字稿</button>
                    <button class="button" onclick="clearTranscription()">🗑️ 清除結果</button>
                    <button class="button" onclick="downloadTranscription()">💾 下載逐字稿</button>
                </div>
            </div>
            
            <!-- 任務分析結果 -->
            <div id="taskResult" class="hidden">
                <h3>📋 任務分析結果</h3>
                <div id="taskContent"></div>
                
                <!-- 任務派遣與通知 -->
                <div id="dispatchSection" class="dispatch-section hidden">
                    <h3>🚀 任務派遣與通知</h3>
                    <div class="dispatch-controls">
                        <button class="button" onclick="dispatchTasks()">📤 派遣任務至後端</button>
                        <button class="button" onclick="sendNotifications()">📧 發送通知給負責人</button>
                        <button class="button" onclick="viewTaskStatus()">📊 查看任務狀態</button>
                    </div>
                    
                    <!-- 後端狀態 -->
                    <div id="backendStatus" class="backend-status hidden">
                        <h4>後端執行狀態</h4>
                        <div id="statusList"></div>
                    </div>
                    
                    <!-- 負責人通知設定 -->
                    <div id="notificationSettings" class="notification-settings hidden">
                        <h4>📧 負責人通知設定</h4>
                        <div class="assignee-list">
                            <div class="assignee-item">
                                <label>艾蜜莉 (品質/法務)</label>
                                <input type="email" placeholder="Gmail 地址" id="emily-gmail">
                                <input type="text" placeholder="Line ID" id="emily-line">
                            </div>
                            <div class="assignee-item">
                                <label>班傑明 (研發/能設)</label>
                                <input type="email" placeholder="Gmail 地址" id="benjamin-gmail">
                                <input type="text" placeholder="Line ID" id="benjamin-line">
                            </div>
                            <div class="assignee-item">
                                <label>克蘿伊 (運籌/職安)</label>
                                <input type="email" placeholder="Gmail 地址" id="chloe-gmail">
                                <input type="text" placeholder="Line ID" id="chloe-line">
                            </div>
                            <div class="assignee-item">
                                <label>丹尼爾 (代工)</label>
                                <input type="email" placeholder="Gmail 地址" id="daniel-gmail">
                                <input type="text" placeholder="Line ID" id="daniel-line">
                            </div>
                            <div class="assignee-item">
                                <label>奥莉薇亞 (人資/行政/總務)</label>
                                <input type="email" placeholder="Gmail 地址" id="olivia-gmail">
                                <input type="text" placeholder="Line ID" id="olivia-line">
                            </div>
                        </div>
                        <div class="controls">
                            <button class="button" onclick="saveNotificationSettings()">💾 儲存設定</button>
                            <button class="button" onclick="testNotifications()">🧪 測試通知</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 語音輸入相關變數
        let recognition = null;
        let isVoiceInputActive = false;
        let voiceText = '';
        
        // 錄音相關變數
        let mediaRecorder = null;
        let audioChunks = [];
        let isRecording = false;
        let isPaused = false;
        let recordingTime = 0;
        let timerInterval = null;
        let accumulatedTime = 0;
        let audioFiles = [];
        let selectedFiles = new Set();
        
        // 語音輸入功能
        function startVoiceInput() {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                alert('您的瀏覽器不支援語音識別功能');
                return;
            }
            
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            
            recognition.continuous = false;
            recognition.interimResults = true;
            recognition.lang = 'zh-TW';
            
            recognition.onstart = () => {
                isVoiceInputActive = true;
                voiceText = '';
                updateVoiceStatus('正在聆聽...', 'recording');
                document.getElementById('startVoiceBtn').classList.add('hidden');
                document.getElementById('stopVoiceBtn').classList.remove('hidden');
            };
            
            recognition.onresult = (event) => {
                let finalTranscript = '';
                let interimTranscript = '';
                
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const transcript = event.results[i][0].transcript;
                    if (event.results[i].isFinal) {
                        finalTranscript += transcript;
                    } else {
                        interimTranscript += transcript;
                    }
                }
                
                voiceText += finalTranscript;
                document.getElementById('voiceInput').value = voiceText + interimTranscript;
            };
            
            recognition.onerror = (event) => {
                console.error('語音識別錯誤:', event.error);
                updateVoiceStatus('語音識別錯誤: ' + event.error, 'error');
                stopVoiceInput();
            };
            
            recognition.onend = () => {
                isVoiceInputActive = false;
                updateVoiceStatus('語音輸入完成', 'ready');
                document.getElementById('startVoiceBtn').classList.remove('hidden');
                document.getElementById('stopVoiceBtn').classList.add('hidden');
                if (voiceText.trim()) {
                    document.getElementById('useVoiceTextBtn').classList.remove('hidden');
                }
            };
            
            recognition.start();
        }
        
        function stopVoiceInput() {
            if (recognition) {
                recognition.stop();
            }
        }
        
        function useVoiceText() {
            const text = document.getElementById('voiceInput').value.trim();
            if (text) {
                processTask(text);
                document.getElementById('useVoiceTextBtn').classList.add('hidden');
                document.getElementById('voiceInput').value = '';
                voiceText = '';
            }
        }
        
        function updateVoiceStatus(message, type) {
            const status = document.getElementById('voiceStatus');
            status.textContent = message;
            status.className = `status ${type}`;
        }
        
        // 錄音功能
        async function startRecording() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    audio: {
                        echoCancellation: true,
                        noiseSuppression: true,
                        sampleRate: 44100
                    } 
                });
                
                mediaRecorder = new MediaRecorder(stream, {
                    mimeType: 'audio/webm;codecs=opus'
                });
                
                audioChunks = [];
                
                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        audioChunks.push(event.data);
                    }
                };
                
                mediaRecorder.onstop = () => {
                    const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                    const duration = accumulatedTime;
                    const timestamp = new Date();
                    
                    const newFile = {
                        id: `recording_${timestamp.getTime()}`,
                        name: `錄音檔案_${audioFiles.length + 1}_${formatTime(duration)}`,
                        blob: audioBlob,
                        duration: duration,
                        timestamp: timestamp
                    };
                    
                    audioFiles.push(newFile);
                    updateFileList();
                    stream.getTracks().forEach(track => track.stop());
                    accumulatedTime = 0;
                };
                
                mediaRecorder.onpause = () => {
                    isPaused = true;
                    if (timerInterval) clearInterval(timerInterval);
                };
                
                mediaRecorder.onresume = () => {
                    isPaused = false;
                    startTimer();
                };
                
                mediaRecorder.start(1000);
                isRecording = true;
                isPaused = false;
                recordingTime = 0;
                accumulatedTime = 0;
                
                updateRecordingStatus('正在錄音...', 'recording');
                document.getElementById('startRecordBtn').classList.add('hidden');
                document.getElementById('pauseRecordBtn').classList.remove('hidden');
                document.getElementById('stopRecordBtn').classList.remove('hidden');
                document.getElementById('timer').classList.remove('hidden');
                
                startTimer();
                
            } catch (error) {
                console.error('無法訪問麥克風:', error);
                alert('無法訪問麥克風，請檢查瀏覽器權限設定。');
            }
        }
        
        function pauseRecording() {
            if (mediaRecorder && isRecording && !isPaused) {
                mediaRecorder.pause();
                updateRecordingStatus('錄音已暫停', 'processing');
                document.getElementById('pauseRecordBtn').classList.add('hidden');
                document.getElementById('resumeRecordBtn').classList.remove('hidden');
            }
        }
        
        function resumeRecording() {
            if (mediaRecorder && isRecording && isPaused) {
                mediaRecorder.resume();
                updateRecordingStatus('正在錄音...', 'recording');
                document.getElementById('resumeRecordBtn').classList.add('hidden');
                document.getElementById('pauseRecordBtn').classList.remove('hidden');
            }
        }
        
        function stopRecording() {
            if (mediaRecorder && isRecording) {
                mediaRecorder.stop();
                isRecording = false;
                isPaused = false;
                if (timerInterval) {
                    clearInterval(timerInterval);
                    timerInterval = null;
                }
                
                updateRecordingStatus('錄音完成', 'ready');
                // 重置所有按鍵狀態
                document.getElementById('startRecordBtn').classList.remove('hidden');
                document.getElementById('pauseRecordBtn').classList.add('hidden');
                document.getElementById('resumeRecordBtn').classList.add('hidden');
                document.getElementById('stopRecordBtn').classList.add('hidden');
                document.getElementById('timer').classList.add('hidden');
            }
        }
        
        function startTimer() {
            timerInterval = setInterval(() => {
                recordingTime++;
                accumulatedTime = recordingTime;
                document.getElementById('timer').textContent = formatTime(recordingTime);
                
                // 每10分鐘自動換檔
                if (recordingTime > 0 && recordingTime % 600 === 0) {
                    console.log('自動換檔：停止當前錄音並開始新錄音');
                    stopRecording();
                    setTimeout(() => {
                        startRecording();
                    }, 1000);
                }
            }, 1000);
        }
        
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        function updateRecordingStatus(message, type) {
            const status = document.getElementById('recordingStatus');
            status.textContent = message;
            status.className = `status ${type}`;
        }
        
        function updateFileList() {
            const container = document.getElementById('filesContainer');
            const fileList = document.getElementById('fileList');
            
            if (audioFiles.length > 0) {
                fileList.classList.remove('hidden');
                container.innerHTML = '';
                
                audioFiles.forEach(file => {
                    const fileItem = document.createElement('div');
                    fileItem.className = 'file-item';
                    fileItem.innerHTML = `
                        <div class="file-info">
                            <div class="file-name">${file.name}</div>
                            <div class="file-details">
                                時長: ${formatTime(file.duration)} | 
                                大小: ${(file.blob.size / 1024 / 1024).toFixed(2)} MB | 
                                時間: ${file.timestamp.toLocaleString()}
                            </div>
                        </div>
                        <div class="file-actions">
                            <input type="checkbox" ${selectedFiles.has(file.id) ? 'checked' : ''} 
                                   onchange="toggleFileSelection('${file.id}')">
                            <button class="button btn-small" onclick="downloadFile('${file.id}')">💾</button>
                            <button class="button btn-small" onclick="deleteFile('${file.id}')">🗑️</button>
                        </div>
                    `;
                    container.appendChild(fileItem);
                });
            } else {
                fileList.classList.add('hidden');
            }
        }
        
        function toggleFileSelection(fileId) {
            if (selectedFiles.has(fileId)) {
                selectedFiles.delete(fileId);
            } else {
                selectedFiles.add(fileId);
            }
        }
        
        function selectAllFiles() {
            selectedFiles.clear();
            audioFiles.forEach(file => selectedFiles.add(file.id));
            updateFileList();
        }
        
        function clearSelection() {
            selectedFiles.clear();
            updateFileList();
        }
        
        function downloadFile(fileId) {
            const file = audioFiles.find(f => f.id === fileId);
            if (file) {
                try {
                    const url = URL.createObjectURL(file.blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${file.name}.webm`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    // 顯示成功訊息
                    showSuccessMessage('✅ 錄音檔案已成功下載！', `檔案 "${file.name}" 已儲存至您的下載資料夾`);
                } catch (error) {
                    console.error('下載錯誤:', error);
                    showErrorMessage('❌ 下載失敗', '無法下載錄音檔案：' + error.message);
                }
            }
        }
        
        function deleteFile(fileId) {
            if (confirm('確定要刪除此檔案嗎？')) {
                audioFiles = audioFiles.filter(f => f.id !== fileId);
                selectedFiles.delete(fileId);
                updateFileList();
            }
        }
        
        async function transcribeSelected() {
            if (selectedFiles.size === 0) {
                alert('請先選擇要轉錄的檔案');
                return;
            }
            
            const selectedAudioFiles = audioFiles.filter(file => selectedFiles.has(file.id));
            let allTranscriptions = [];
            
            document.getElementById('transcriptionSection').classList.remove('hidden');
            document.getElementById('transcriptionText').textContent = '正在轉錄中，請稍候...';
            
            try {
                for (const file of selectedAudioFiles) {
                    const formData = new FormData();
                    formData.append('audio', file.blob, `${file.name}.webm`);
                    formData.append('mimeType', 'audio/webm');
                    formData.append('languageCode', 'zh-TW');
                    
                    // 這裡應該調用後端 API，暫時使用模擬
                    await new Promise(resolve => setTimeout(resolve, 2000)); // 模擬轉錄時間
                    
                    const mockTranscription = `【${file.name}】\n這是模擬的轉錄結果。實際應用中會調用 Google Cloud Speech-to-Text API 進行轉錄。\n\n`;
                    allTranscriptions.push(mockTranscription);
                }
                
                const combinedTranscription = allTranscriptions.join('---\n\n');
                document.getElementById('transcriptionText').textContent = combinedTranscription;
                
                // 清除已轉錄的檔案
                audioFiles = audioFiles.filter(file => !selectedFiles.has(file.id));
                selectedFiles.clear();
                updateFileList();
                
            } catch (error) {
                console.error('轉錄錯誤:', error);
                alert('轉錄失敗: ' + error.message);
            }
        }
        
        function useTranscription() {
            const transcription = document.getElementById('transcriptionText').textContent;
            if (transcription.trim()) {
                processTask(transcription);
            }
        }
        
        function clearTranscription() {
            document.getElementById('transcriptionText').textContent = '轉逐字稿結果將顯示在此處...';
            document.getElementById('transcriptionSection').classList.add('hidden');
        }
        
        function downloadTranscription() {
            const transcription = document.getElementById('transcriptionText').textContent;
            if (transcription.trim() && transcription !== '轉逐字稿結果將顯示在此處...') {
                try {
                    const blob = new Blob([transcription], { type: 'text/plain;charset=utf-8' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `逐字稿_${new Date().toISOString().split('T')[0]}.txt`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    // 顯示成功訊息
                    showSuccessMessage('✅ 逐字稿檔案已成功下載！', '逐字稿已儲存至您的下載資料夾');
                } catch (error) {
                    console.error('下載錯誤:', error);
                    showErrorMessage('❌ 下載失敗', '無法下載逐字稿檔案：' + error.message);
                }
            } else {
                showErrorMessage('❌ 下載失敗', '沒有逐字稿內容可下載');
            }
        }
        
        // 任務處理
        async function processTask(text) {
            if (!text.trim()) {
                alert('請輸入任務描述');
                return;
            }
            
            // 顯示處理中狀態
            const resultDiv = document.getElementById('taskResult');
            const contentDiv = document.getElementById('taskContent');
            resultDiv.classList.remove('hidden');
            contentDiv.innerHTML = '<div class="status processing">🔄 正在使用 Gemini 2.5 Flash 分析任務...</div>';
            
            try {
                // 調用後端 API 進行 AI 分析
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        text: text,
                        timestamp: new Date().toISOString()
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                displayTaskResult(result);
                
            } catch (error) {
                console.error('AI 分析錯誤:', error);
                
                // 顯示錯誤訊息，不使用模擬結果
                contentDiv.innerHTML = `
                    <div class="status error">
                        <h4>❌ AI 分析失敗</h4>
                        <p><strong>錯誤原因：</strong> ${error.message}</p>
                        <p><strong>可能原因：</strong></p>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>後端服務未啟動或無法連接</li>
                            <li>Gemini API 金鑰未設定或無效</li>
                            <li>網路連接問題</li>
                            <li>後端 API 端點錯誤</li>
                        </ul>
                        <p><strong>建議解決方案：</strong></p>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>檢查後端服務是否正常運行</li>
                            <li>確認 Gemini API 金鑰設定正確</li>
                            <li>檢查網路連接狀態</li>
                            <li>聯繫系統管理員</li>
                        </ul>
                    </div>
                `;
            }
        }
        
        function displayTaskResult(result) {
            const resultDiv = document.getElementById('taskResult');
            const contentDiv = document.getElementById('taskContent');
            const dispatchSection = document.getElementById('dispatchSection');
            
            let html = '<div style="background: #e9ecef; padding: 20px; border-radius: 8px; margin: 15px 0;">';
            html += '<h4>📋 任務列表</h4>';
            result.tasks.forEach((task, index) => {
                html += `<div style="background: white; padding: 15px; margin: 10px 0; border-left: 4px solid #4facfe; border-radius: 5px;">`;
                html += `<strong>${task.title}</strong><br>`;
                html += `<small style="color: #666;">優先級: ${task.priority} | 負責人: ${task.assignee} | 狀態: ${task.status}</small>`;
                html += `<p style="margin-top: 10px;">${task.description}</p>`;
                html += `</div>`;
            });
            html += '</div>';
            
            html += '<div style="background: #d4edda; padding: 15px; border-radius: 8px; margin: 15px 0;">';
            html += '<h4>📝 摘要</h4>';
            html += `<p>${result.summary}</p>`;
            html += '</div>';
            
            contentDiv.innerHTML = html;
            resultDiv.classList.remove('hidden');
            dispatchSection.classList.remove('hidden');
            
            // 儲存任務結果供後續使用
            window.currentTaskResult = result;
        }
        
        // 任務派遣功能
        async function dispatchTasks() {
            if (!window.currentTaskResult) {
                alert('沒有可派遣的任務');
                return;
            }
            
            const statusDiv = document.getElementById('backendStatus');
            const statusList = document.getElementById('statusList');
            
            statusDiv.classList.remove('hidden');
            statusList.innerHTML = '<div class="status-item">🔄 正在派遣任務至後端系統...</div>';
            
            try {
                const response = await fetch('/api/dispatch', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        tasks: window.currentTaskResult.tasks,
                        summary: window.currentTaskResult.summary
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                
                // 顯示派遣結果
                statusList.innerHTML = `
                    <div class="status-item">✅ Firestore: ${result.firestore || '任務已儲存至 Firestore'}</div>
                    <div class="status-item">✅ Google Sheets: ${result.sheets || '任務已新增至 Google Sheets'}</div>
                    <div class="status-item">✅ Google Docs: ${result.docs || '任務文件已建立'}</div>
                    <div class="status-item">⏳ 通知: 等待手動觸發負責人通知</div>
                `;
                
            } catch (error) {
                console.error('任務派遣錯誤:', error);
                statusList.innerHTML = `
                    <div class="status-item error">
                        <h4>❌ 任務派遣失敗</h4>
                        <p><strong>錯誤原因：</strong> ${error.message}</p>
                        <p><strong>可能原因：</strong></p>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>後端服務未啟動或無法連接</li>
                            <li>Firestore 連接問題</li>
                            <li>Google Sheets API 設定錯誤</li>
                            <li>Google Docs API 權限問題</li>
                        </ul>
                        <p><strong>建議解決方案：</strong></p>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>檢查後端服務狀態</li>
                            <li>確認 Google Cloud 服務設定</li>
                            <li>檢查 API 金鑰和權限</li>
                            <li>聯繫系統管理員</li>
                        </ul>
                    </div>
                `;
            }
        }
        
        // 發送通知功能
        async function sendNotifications() {
            if (!window.currentTaskResult) {
                alert('沒有可通知的任務');
                return;
            }
            
            const statusList = document.getElementById('statusList');
            statusList.innerHTML += '<div class="status-item">📧 正在發送通知給負責人...</div>';
            
            try {
                // 收集負責人通知資訊
                const notifications = [];
                const assignees = ['emily', 'benjamin', 'chloe', 'daniel', 'olivia'];
                
                assignees.forEach(assignee => {
                    const gmail = document.getElementById(`${assignee}-gmail`).value;
                    const lineId = document.getElementById(`${assignee}-line`).value;
                    
                    if (gmail || lineId) {
                        notifications.push({
                            assignee: assignee,
                            gmail: gmail,
                            lineId: lineId,
                            tasks: window.currentTaskResult.tasks.filter(task => 
                                task.assignee.toLowerCase().includes(assignee)
                            )
                        });
                    }
                });
                
                if (notifications.length === 0) {
                    alert('請先設定負責人的聯絡資訊');
                    return;
                }
                
                const response = await fetch('/api/notify', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        notifications: notifications
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                statusList.innerHTML += '<div class="status-item">✅ 通知已發送: ' + result.message + '</div>';
                
            } catch (error) {
                console.error('通知發送錯誤:', error);
                statusList.innerHTML += `
                    <div class="status-item error">
                        <h4>❌ 通知發送失敗</h4>
                        <p><strong>錯誤原因：</strong> ${error.message}</p>
                        <p><strong>可能原因：</strong></p>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>Gmail API 設定錯誤或權限不足</li>
                            <li>Line Notify API 金鑰無效</li>
                            <li>負責人聯絡資訊設定錯誤</li>
                            <li>網路連接問題</li>
                        </ul>
                        <p><strong>建議解決方案：</strong></p>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>檢查 Gmail 和 Line API 設定</li>
                            <li>確認負責人聯絡資訊正確</li>
                            <li>檢查網路連接狀態</li>
                            <li>聯繫系統管理員</li>
                        </ul>
                    </div>
                `;
            }
        }
        
        // 查看任務狀態
        function viewTaskStatus() {
            const statusDiv = document.getElementById('backendStatus');
            const statusList = document.getElementById('statusList');
            
            statusDiv.classList.remove('hidden');
            statusList.innerHTML = `
                <div class="status-item">📊 任務狀態總覽</div>
                <div class="status-item">📋 總任務數: ${window.currentTaskResult?.tasks?.length || 0}</div>
                <div class="status-item">👥 涉及負責人: ${getUniqueAssignees()}</div>
                <div class="status-item">⏰ 建立時間: ${new Date().toLocaleString()}</div>
            `;
        }
        
        function getUniqueAssignees() {
            if (!window.currentTaskResult?.tasks) return '無';
            const assignees = [...new Set(window.currentTaskResult.tasks.map(task => task.assignee))];
            return assignees.join(', ');
        }
        
        // 儲存通知設定
        function saveNotificationSettings() {
            const settings = {};
            const assignees = ['emily', 'benjamin', 'chloe', 'daniel', 'olivia'];
            
            assignees.forEach(assignee => {
                settings[assignee] = {
                    gmail: document.getElementById(`${assignee}-gmail`).value,
                    lineId: document.getElementById(`${assignee}-line`).value
                };
            });
            
            localStorage.setItem('notificationSettings', JSON.stringify(settings));
            alert('通知設定已儲存！');
        }
        
        // 載入通知設定
        function loadNotificationSettings() {
            const settings = JSON.parse(localStorage.getItem('notificationSettings') || '{}');
            const assignees = ['emily', 'benjamin', 'chloe', 'daniel', 'olivia'];
            
            assignees.forEach(assignee => {
                if (settings[assignee]) {
                    document.getElementById(`${assignee}-gmail`).value = settings[assignee].gmail || '';
                    document.getElementById(`${assignee}-line`).value = settings[assignee].lineId || '';
                }
            });
        }
        
        // 測試通知
        async function testNotifications() {
            const assignees = ['emily', 'benjamin', 'chloe', 'daniel', 'olivia'];
            let hasSettings = false;
            
            assignees.forEach(assignee => {
                const gmail = document.getElementById(`${assignee}-gmail`).value;
                const lineId = document.getElementById(`${assignee}-line`).value;
                if (gmail || lineId) hasSettings = true;
            });
            
            if (!hasSettings) {
                alert('請先設定至少一個負責人的聯絡資訊');
                return;
            }
            
            try {
                const response = await fetch('/api/test-notify', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: '這是一個測試通知，用於驗證通知系統是否正常運作。'
                    })
                });
                
                if (response.ok) {
                    alert('測試通知已發送！請檢查負責人的 Gmail 和 Line。');
                } else {
                    throw new Error('測試通知發送失敗');
                }
                
            } catch (error) {
                console.error('測試通知錯誤:', error);
                alert('測試通知發送失敗: ' + error.message);
            }
        }
        
        // 輸入方式切換
        function switchInputMethod(method) {
            // 隱藏所有輸入區域
            document.querySelectorAll('.input-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // 移除所有按鍵的 active 狀態
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // 顯示選中的輸入區域
            document.getElementById(method + '-input').classList.add('active');
            
            // 設定按鍵為 active 狀態
            event.target.classList.add('active');
        }
        
        // 手動輸入功能
        function processManualInput() {
            const text = document.getElementById('manualInput').value.trim();
            if (text) {
                processTask(text);
            } else {
                alert('請輸入任務描述');
            }
        }
        
        function clearManualInput() {
            document.getElementById('manualInput').value = '';
        }
        
        // 螢幕截圖功能
        function startScreenshot() {
            // 這裡可以整合第三方截圖工具或瀏覽器 API
            alert('螢幕截圖功能需要整合第三方工具或瀏覽器擴展。\n\n建議使用：\n1. 瀏覽器截圖擴展\n2. 系統截圖工具\n3. 拖拽圖片到此區域');
        }
        
        function handleScreenshotDrop(event) {
            event.preventDefault();
            const files = event.dataTransfer.files;
            if (files.length > 0) {
                handleScreenshotFile(files[0]);
            }
        }
        
        function handleDragOver(event) {
            event.preventDefault();
        }
        
        function handleScreenshotFile(file) {
            if (file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('screenshotImage').src = e.target.result;
                    document.getElementById('screenshotPreview').classList.remove('hidden');
                    document.getElementById('screenshotPlaceholder').classList.add('hidden');
                };
                reader.readAsDataURL(file);
            } else {
                alert('請選擇圖片檔案');
            }
        }
        
        function analyzeScreenshot() {
            const img = document.getElementById('screenshotImage');
            if (img.src) {
                // 這裡可以整合 OCR 或圖像分析 API
                const mockAnalysis = '【截圖分析】\n這是一個模擬的截圖分析結果。實際應用中會使用 OCR 技術提取圖片中的文字內容。';
                processTask(mockAnalysis);
            } else {
                alert('請先上傳截圖');
            }
        }
        
        function clearScreenshot() {
            document.getElementById('screenshotPreview').classList.add('hidden');
            document.getElementById('screenshotPlaceholder').classList.remove('hidden');
            document.getElementById('screenshotImage').src = '';
        }
        
        // 檔案上傳功能
        function handleFileDrop(event) {
            event.preventDefault();
            const files = event.dataTransfer.files;
            handleFiles(files);
        }
        
        function handleFileSelect(event) {
            const files = event.target.files;
            handleFiles(files);
        }
        
        function handleFiles(files) {
            const uploadedFiles = document.getElementById('uploadedFiles');
            const filesList = document.getElementById('filesList');
            
            uploadedFiles.classList.remove('hidden');
            filesList.innerHTML = '';
            
            Array.from(files).forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <div class="file-info">
                        <div class="file-name">${file.name}</div>
                        <div class="file-details">
                            大小: ${(file.size / 1024 / 1024).toFixed(2)} MB | 
                            類型: ${file.type || '未知'}
                        </div>
                    </div>
                    <div class="file-actions">
                        <button class="button btn-small" onclick="removeFile(${index})">🗑️</button>
                    </div>
                `;
                filesList.appendChild(fileItem);
            });
        }
        
        function removeFile(index) {
            // 移除檔案邏輯
            const filesList = document.getElementById('filesList');
            const fileItems = filesList.querySelectorAll('.file-item');
            if (fileItems[index]) {
                fileItems[index].remove();
            }
        }
        
        function analyzeUploadedFiles() {
            const filesList = document.getElementById('filesList');
            const fileItems = filesList.querySelectorAll('.file-item');
            if (fileItems.length > 0) {
                // 這裡可以整合檔案解析 API
                const mockAnalysis = '【檔案分析】\n這是模擬的檔案分析結果。實際應用中會解析 Word、PDF、JSON、Markdown 等檔案內容。';
                processTask(mockAnalysis);
            } else {
                alert('請先上傳檔案');
            }
        }
        
        function clearUploadedFiles() {
            document.getElementById('uploadedFiles').classList.add('hidden');
            document.getElementById('filesList').innerHTML = '';
        }
        
        // 雲端檔案功能
        function fetchCloudDocument() {
            const url = document.getElementById('cloudUrl').value.trim();
            if (url) {
                // 這裡可以整合 Google Docs API 或其他雲端服務
                const mockContent = '【雲端檔案內容】\n這是模擬的雲端檔案內容。實際應用中會通過 API 獲取 Google Docs 或其他雲端服務的檔案內容。';
                
                document.getElementById('cloudContent').textContent = mockContent;
                document.getElementById('cloudPreview').classList.remove('hidden');
            } else {
                alert('請輸入雲端檔案連結');
            }
        }
        
        function analyzeCloudDocument() {
            const content = document.getElementById('cloudContent').textContent;
            if (content) {
                processTask(content);
            } else {
                alert('請先載入雲端檔案');
            }
        }
        
        function clearCloudInput() {
            document.getElementById('cloudUrl').value = '';
            document.getElementById('cloudPreview').classList.add('hidden');
        }
        
        // 文字貼文功能
        function processTextInput() {
            const text = document.getElementById('textInput').value.trim();
            if (text) {
                processTask(text);
            } else {
                alert('請貼上文字內容');
            }
        }
        
        function clearTextInput() {
            document.getElementById('textInput').value = '';
        }
        
        // 初始化
        console.log('AI 任務派遣中心 - 多種輸入方式版載入成功');
        
        // 成功訊息顯示
        function showSuccessMessage(title, message) {
            const notification = document.createElement('div');
            notification.className = 'notification success';
            notification.innerHTML = `
                <div style="background: #d4edda; border: 1px solid #c3e6cb; color: #155724; padding: 15px; border-radius: 8px; margin: 10px 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <h4 style="margin: 0 0 5px 0; font-size: 16px;">${title}</h4>
                    <p style="margin: 0; font-size: 14px;">${message}</p>
                </div>
            `;
            
            // 插入到頁面頂部
            const container = document.querySelector('.container');
            container.insertBefore(notification, container.firstChild);
            
            // 3秒後自動移除
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
        }
        
        // 錯誤訊息顯示
        function showErrorMessage(title, message) {
            const notification = document.createElement('div');
            notification.className = 'notification error';
            notification.innerHTML = `
                <div style="background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; padding: 15px; border-radius: 8px; margin: 10px 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <h4 style="margin: 0 0 5px 0; font-size: 16px;">${title}</h4>
                    <p style="margin: 0; font-size: 14px;">${message}</p>
                </div>
            `;
            
            // 插入到頁面頂部
            const container = document.querySelector('.container');
            container.insertBefore(notification, container.firstChild);
            
            // 5秒後自動移除
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 5000);
        }
        
        // 載入通知設定
        document.addEventListener('DOMContentLoaded', function() {
            loadNotificationSettings();
        });
    </script>
</body>
</html>