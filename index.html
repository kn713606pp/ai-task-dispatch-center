<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ä»»å‹™æ´¾é£ä¸­å¿ƒ - èªéŸ³è¼¸å…¥ç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .main-content {
            padding: 30px;
        }
        
        .voice-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .voice-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }
        
        .voice-card:hover {
            border-color: #4facfe;
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.2);
        }
        
        .voice-card h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .voice-input {
            background: #fff;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            min-height: 200px;
            font-size: 16px;
            resize: vertical;
            transition: border-color 0.3s ease;
        }
        
        .voice-input:focus {
            outline: none;
            border-color: #4facfe;
        }
        
        .button {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.4);
        }
        
        .button:active {
            transform: translateY(0);
        }
        
        .button.recording {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
        }
        
        .button.processing {
            background: linear-gradient(135deg, #ffa726 0%, #ff9800 100%);
        }
        
        .timer {
            font-size: 2em;
            font-weight: bold;
            color: #ff6b6b;
            text-align: center;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
        }
        
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 500;
        }
        
        .status.recording {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #ffcdd2;
        }
        
        .status.processing {
            background: #fff3e0;
            color: #ef6c00;
            border: 1px solid #ffcc02;
        }
        
        .status.ready {
            background: #e8f5e8;
            color: #2e7d32;
            border: 1px solid #c8e6c9;
        }
        
        .file-list {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: white;
            border-radius: 5px;
            margin: 5px 0;
            border: 1px solid #e9ecef;
        }
        
        .file-info {
            flex: 1;
        }
        
        .file-name {
            font-weight: 600;
            color: #333;
        }
        
        .file-details {
            font-size: 0.9em;
            color: #666;
            margin-top: 2px;
        }
        
        .file-actions {
            display: flex;
            gap: 5px;
        }
        
        .btn-small {
            padding: 5px 10px;
            font-size: 12px;
            border-radius: 15px;
        }
        
        .transcription-result {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            min-height: 200px;
        }
        
        .transcription-text {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            min-height: 150px;
            font-size: 16px;
            line-height: 1.6;
            white-space: pre-wrap;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .pulse {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .hidden {
            display: none;
        }
        
        /* è¼¸å…¥æ–¹å¼é¸æ“‡æ¨£å¼ */
        .input-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .tab-button {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            color: #666;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .tab-button:hover {
            border-color: #4facfe;
            color: #4facfe;
        }
        
        .tab-button.active {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            border-color: #4facfe;
            color: white;
        }
        
        .input-section {
            display: none;
        }
        
        .input-section.active {
            display: block;
        }
        
        /* ä¸Šå‚³å€åŸŸæ¨£å¼ */
        .upload-area, .screenshot-area {
            border: 2px dashed #ddd;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            transition: all 0.3s ease;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .upload-area:hover, .screenshot-area:hover {
            border-color: #4facfe;
            background: #f8f9ff;
        }
        
        .upload-placeholder, .screenshot-placeholder {
            text-align: center;
        }
        
        .uploaded-files, .cloud-preview {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: white;
            border-radius: 5px;
            margin: 5px 0;
            border: 1px solid #e9ecef;
        }
        
        .cloud-url-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 15px;
        }
        
        .cloud-url-input:focus {
            outline: none;
            border-color: #4facfe;
        }
        
        .screenshot-preview {
            text-align: center;
        }
        
        /* ä»»å‹™æ´¾é£èˆ‡é€šçŸ¥æ¨£å¼ */
        .dispatch-section {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid #e9ecef;
        }
        
        .dispatch-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .backend-status {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        
        .status-item {
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            border-left: 4px solid #4facfe;
            background: #f8f9ff;
        }
        
        .notification-settings {
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        
        .assignee-list {
            margin: 15px 0;
        }
        
        .assignee-item {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            padding: 10px;
            margin: 10px 0;
            background: #f8f9fa;
            border-radius: 5px;
            align-items: center;
        }
        
        .assignee-item label {
            font-weight: 600;
            color: #333;
        }
        
        .assignee-item input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .assignee-item input:focus {
            outline: none;
            border-color: #4facfe;
        }
        
        @media (max-width: 768px) {
            .voice-section {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .input-tabs {
                flex-direction: column;
                align-items: center;
            }
            
            .tab-button {
                width: 100%;
                max-width: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¤ AI ä»»å‹™æ´¾é£ä¸­å¿ƒ</h1>
            <p>æ™ºèƒ½èªéŸ³è¼¸å…¥èˆ‡ä»»å‹™åˆ†æç³»çµ±</p>
        </div>
        
        <div class="main-content">
            <!-- å¤šç¨®è¼¸å…¥æ–¹å¼ -->
            <div class="input-methods">
                <h2 style="text-align: center; margin-bottom: 30px; color: #333;">ğŸ“ å¤šç¨®è¼¸å…¥æ–¹å¼</h2>
                
                <!-- è¼¸å…¥æ–¹å¼é¸æ“‡ -->
                <div class="input-tabs">
                    <button class="tab-button active" onclick="switchInputMethod('voice')">ğŸ¤ èªéŸ³è¼¸å…¥</button>
                    <button class="tab-button" onclick="switchInputMethod('manual')">âŒ¨ï¸ æ‰‹å‹•è¼¸å…¥</button>
                    <button class="tab-button" onclick="switchInputMethod('screenshot')">ğŸ“¸ è¢å¹•æˆªåœ–</button>
                    <button class="tab-button" onclick="switchInputMethod('upload')">ğŸ“ ä¸Šå‚³æª”æ¡ˆ</button>
                    <button class="tab-button" onclick="switchInputMethod('cloud')">â˜ï¸ é›²ç«¯æª”æ¡ˆ</button>
                    <button class="tab-button" onclick="switchInputMethod('text')">ğŸ“„ æ–‡å­—è²¼æ–‡</button>
                </div>
                
                <!-- èªéŸ³è¼¸å…¥å€åŸŸ -->
                <div id="voice-input" class="input-section active">
                    <div class="voice-section">
                        <!-- å³æ™‚èªéŸ³è¼¸å…¥ -->
                        <div class="voice-card">
                            <h3>ğŸ™ï¸ å³æ™‚èªéŸ³è¼¸å…¥</h3>
                            <div id="voiceStatus" class="status ready">æº–å‚™å°±ç·’ - é»æ“Šé–‹å§‹èªéŸ³è¼¸å…¥</div>
                            <div class="controls">
                                <button id="startVoiceBtn" class="button" onclick="startVoiceInput()">
                                    ğŸ¤ é–‹å§‹èªéŸ³è¼¸å…¥
                                </button>
                                <button id="stopVoiceBtn" class="button hidden" onclick="stopVoiceInput()">
                                    â¹ï¸ åœæ­¢èªéŸ³è¼¸å…¥
                                </button>
                                <button id="useVoiceTextBtn" class="button hidden" onclick="useVoiceText()">
                                    âœ… ä½¿ç”¨æ­¤æ–‡å­—
                                </button>
                            </div>
                            <textarea id="voiceInput" class="voice-input" placeholder="èªéŸ³è¼¸å…¥çµæœå°‡é¡¯ç¤ºåœ¨æ­¤è™•..."></textarea>
                        </div>
                        
                        <!-- éŒ„éŸ³åŠŸèƒ½ -->
                        <div class="voice-card">
                            <h3>ğŸ™ï¸ éŒ„éŸ³åŠŸèƒ½</h3>
                            <div id="recordingStatus" class="status ready">æº–å‚™éŒ„éŸ³</div>
                            <div id="timer" class="timer hidden">00:00</div>
                            
                            <!-- éŒ„éŸ³æ§åˆ¶æŒ‰éµ -->
                            <div class="controls">
                                <button id="startRecordBtn" class="button" onclick="startRecording()">
                                    âºï¸ é–‹å§‹éŒ„éŸ³
                                </button>
                                <button id="pauseRecordBtn" class="button hidden" onclick="pauseRecording()">
                                    â¸ï¸ æš«åœéŒ„éŸ³
                                </button>
                                <button id="resumeRecordBtn" class="button hidden" onclick="resumeRecording()">
                                    â–¶ï¸ ç¹¼çºŒéŒ„éŸ³
                                </button>
                                <button id="stopRecordBtn" class="button hidden" onclick="stopRecording()">
                                    â¹ï¸ åœæ­¢éŒ„éŸ³
                                </button>
                            </div>
                            
                            <!-- éŒ„éŸ³æª”æ¡ˆåˆ—è¡¨ -->
                            <div id="fileList" class="file-list hidden">
                                <h4>ğŸ“ éŒ„éŸ³æª”æ¡ˆ</h4>
                                <div id="filesContainer"></div>
                                <div class="controls">
                                    <button class="button btn-small" onclick="selectAllFiles()">å…¨é¸</button>
                                    <button class="button btn-small" onclick="clearSelection()">æ¸…é™¤é¸æ“‡</button>
                                    <button class="button btn-small" onclick="transcribeSelected()">è½‰é€å­—ç¨¿</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- æ‰‹å‹•è¼¸å…¥å€åŸŸ -->
                <div id="manual-input" class="input-section">
                    <div class="voice-card">
                        <h3>âŒ¨ï¸ æ‰‹å‹•è¼¸å…¥</h3>
                        <textarea id="manualInput" class="voice-input" placeholder="è«‹åœ¨æ­¤è¼¸å…¥æ‚¨çš„ä»»å‹™æè¿°..."></textarea>
                        <div class="controls">
                            <button class="button" onclick="processManualInput()">ğŸ“ åˆ†æä»»å‹™</button>
                            <button class="button" onclick="clearManualInput()">ğŸ—‘ï¸ æ¸…é™¤</button>
                        </div>
                    </div>
                </div>
                
                <!-- è¢å¹•æˆªåœ–å€åŸŸ -->
                <div id="screenshot-input" class="input-section">
                    <div class="voice-card">
                        <h3>ğŸ“¸ è¢å¹•æˆªåœ–</h3>
                        <div class="status info">é»æ“Šä¸‹æ–¹æŒ‰éˆ•é–‹å§‹è¢å¹•æˆªåœ–ï¼Œæˆ–æ‹–æ‹½åœ–ç‰‡åˆ°æ­¤å€åŸŸ</div>
                        <div id="screenshotArea" class="screenshot-area" ondrop="handleScreenshotDrop(event)" ondragover="handleDragOver(event)">
                            <div id="screenshotPreview" class="screenshot-preview hidden">
                                <img id="screenshotImage" style="max-width: 100%; max-height: 300px; border-radius: 5px;">
                                <div class="controls">
                                    <button class="button" onclick="analyzeScreenshot()">ğŸ” åˆ†ææˆªåœ–</button>
                                    <button class="button" onclick="clearScreenshot()">ğŸ—‘ï¸ æ¸…é™¤</button>
                                </div>
                            </div>
                            <div id="screenshotPlaceholder" class="screenshot-placeholder">
                                <p>ğŸ“¸ é»æ“ŠæŒ‰éˆ•é–‹å§‹æˆªåœ–æˆ–æ‹–æ‹½åœ–ç‰‡åˆ°æ­¤è™•</p>
                                <button class="button" onclick="startScreenshot()">ğŸ“¸ é–‹å§‹æˆªåœ–</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- æª”æ¡ˆä¸Šå‚³å€åŸŸ -->
                <div id="upload-input" class="input-section">
                    <div class="voice-card">
                        <h3>ğŸ“ ä¸Šå‚³æª”æ¡ˆ</h3>
                        <div class="status info">æ”¯æ´ Wordã€PDFã€JSONã€Markdown æª”æ¡ˆ</div>
                        <div id="uploadArea" class="upload-area" ondrop="handleFileDrop(event)" ondragover="handleDragOver(event)">
                            <input type="file" id="fileInput" accept=".doc,.docx,.pdf,.json,.md,.txt" multiple style="display: none;" onchange="handleFileSelect(event)">
                            <div id="uploadPlaceholder" class="upload-placeholder">
                                <p>ğŸ“ é»æ“Šé¸æ“‡æª”æ¡ˆæˆ–æ‹–æ‹½åˆ°æ­¤è™•</p>
                                <button class="button" onclick="document.getElementById('fileInput').click()">ğŸ“ é¸æ“‡æª”æ¡ˆ</button>
                            </div>
                            <div id="uploadedFiles" class="uploaded-files hidden">
                                <h4>å·²ä¸Šå‚³æª”æ¡ˆ</h4>
                                <div id="filesList"></div>
                                <div class="controls">
                                    <button class="button" onclick="analyzeUploadedFiles()">ğŸ“ åˆ†ææª”æ¡ˆ</button>
                                    <button class="button" onclick="clearUploadedFiles()">ğŸ—‘ï¸ æ¸…é™¤</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- é›²ç«¯æª”æ¡ˆå€åŸŸ -->
                <div id="cloud-input" class="input-section">
                    <div class="voice-card">
                        <h3>â˜ï¸ é›²ç«¯æª”æ¡ˆ</h3>
                        <div class="status info">é€£æ¥ Google Docs æˆ–å…¶ä»–é›²ç«¯æœå‹™</div>
                        <div class="cloud-input-area">
                            <input type="url" id="cloudUrl" class="cloud-url-input" placeholder="è«‹è¼¸å…¥ Google Docs æˆ–å…¶ä»–é›²ç«¯æª”æ¡ˆé€£çµ...">
                            <div class="controls">
                                <button class="button" onclick="fetchCloudDocument()">â˜ï¸ è¼‰å…¥é›²ç«¯æª”æ¡ˆ</button>
                                <button class="button" onclick="clearCloudInput()">ğŸ—‘ï¸ æ¸…é™¤</button>
                            </div>
                            <div id="cloudPreview" class="cloud-preview hidden">
                                <h4>é›²ç«¯æª”æ¡ˆé è¦½</h4>
                                <div id="cloudContent"></div>
                                <div class="controls">
                                    <button class="button" onclick="analyzeCloudDocument()">ğŸ“ åˆ†æé›²ç«¯æª”æ¡ˆ</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- æ–‡å­—è²¼æ–‡å€åŸŸ -->
                <div id="text-input" class="input-section">
                    <div class="voice-card">
                        <h3>ğŸ“„ æ–‡å­—è²¼æ–‡</h3>
                        <div class="status info">è²¼ä¸Šä»»ä½•æ–‡å­—å…§å®¹é€²è¡Œåˆ†æ</div>
                        <textarea id="textInput" class="voice-input" placeholder="è«‹è²¼ä¸Šæ–‡å­—å…§å®¹..."></textarea>
                        <div class="controls">
                            <button class="button" onclick="processTextInput()">ğŸ“ åˆ†ææ–‡å­—</button>
                            <button class="button" onclick="clearTextInput()">ğŸ—‘ï¸ æ¸…é™¤</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- è½‰é€å­—ç¨¿è¦–çª— -->
            <div id="transcriptionSection" class="transcription-result hidden">
                <h3>ğŸ“ è½‰é€å­—ç¨¿çµæœ</h3>
                <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 5px; padding: 10px; margin-bottom: 15px;">
                    <strong>ğŸ’¡ æç¤ºï¼š</strong> è½‰é€å­—ç¨¿åŠŸèƒ½æœƒå°‡é¸ä¸­çš„éŒ„éŸ³æª”æ¡ˆè½‰æ›ç‚ºæ–‡å­—å…§å®¹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨é€™äº›æ–‡å­—é€²è¡Œä»»å‹™åˆ†æã€‚
                </div>
                <div id="transcriptionText" class="transcription-text">è½‰é€å­—ç¨¿çµæœå°‡é¡¯ç¤ºåœ¨æ­¤è™•...</div>
                <div class="controls">
                    <button class="button" onclick="useTranscription()">âœ… ä½¿ç”¨æ­¤é€å­—ç¨¿</button>
                    <button class="button" onclick="clearTranscription()">ğŸ—‘ï¸ æ¸…é™¤çµæœ</button>
                    <button class="button" onclick="downloadTranscription()">ğŸ’¾ ä¸‹è¼‰é€å­—ç¨¿</button>
                </div>
            </div>
            
            <!-- ä»»å‹™åˆ†æçµæœ -->
            <div id="taskResult" class="hidden">
                <h3>ğŸ“‹ ä»»å‹™åˆ†æçµæœ</h3>
                <div id="taskContent"></div>
                
                <!-- ä»»å‹™æ´¾é£èˆ‡é€šçŸ¥ -->
                <div id="dispatchSection" class="dispatch-section hidden">
                    <h3>ğŸš€ ä»»å‹™æ´¾é£èˆ‡é€šçŸ¥</h3>
                    <div class="dispatch-controls">
                        <button class="button" onclick="dispatchTasks()">ğŸ“¤ æ´¾é£ä»»å‹™è‡³å¾Œç«¯</button>
                        <button class="button" onclick="sendNotifications()">ğŸ“§ ç™¼é€é€šçŸ¥çµ¦è² è²¬äºº</button>
                        <button class="button" onclick="viewTaskStatus()">ğŸ“Š æŸ¥çœ‹ä»»å‹™ç‹€æ…‹</button>
                    </div>
                    
                    <!-- å¾Œç«¯ç‹€æ…‹ -->
                    <div id="backendStatus" class="backend-status hidden">
                        <h4>å¾Œç«¯åŸ·è¡Œç‹€æ…‹</h4>
                        <div id="statusList"></div>
                    </div>
                    
                    <!-- è² è²¬äººé€šçŸ¥è¨­å®š -->
                    <div id="notificationSettings" class="notification-settings hidden">
                        <h4>ğŸ“§ è² è²¬äººé€šçŸ¥è¨­å®š</h4>
                        <div class="assignee-list">
                            <div class="assignee-item">
                                <label>è‰¾èœœè‰ (å“è³ª/æ³•å‹™)</label>
                                <input type="email" placeholder="Gmail åœ°å€" id="emily-gmail">
                                <input type="text" placeholder="Line ID" id="emily-line">
                            </div>
                            <div class="assignee-item">
                                <label>ç­å‚‘æ˜ (ç ”ç™¼/èƒ½è¨­)</label>
                                <input type="email" placeholder="Gmail åœ°å€" id="benjamin-gmail">
                                <input type="text" placeholder="Line ID" id="benjamin-line">
                            </div>
                            <div class="assignee-item">
                                <label>å…‹è˜¿ä¼Š (é‹ç±Œ/è·å®‰)</label>
                                <input type="email" placeholder="Gmail åœ°å€" id="chloe-gmail">
                                <input type="text" placeholder="Line ID" id="chloe-line">
                            </div>
                            <div class="assignee-item">
                                <label>ä¸¹å°¼çˆ¾ (ä»£å·¥)</label>
                                <input type="email" placeholder="Gmail åœ°å€" id="daniel-gmail">
                                <input type="text" placeholder="Line ID" id="daniel-line">
                            </div>
                            <div class="assignee-item">
                                <label>å¥¥è‰è–‡äº (äººè³‡/è¡Œæ”¿/ç¸½å‹™)</label>
                                <input type="email" placeholder="Gmail åœ°å€" id="olivia-gmail">
                                <input type="text" placeholder="Line ID" id="olivia-line">
                            </div>
                        </div>
                        <div class="controls">
                            <button class="button" onclick="saveNotificationSettings()">ğŸ’¾ å„²å­˜è¨­å®š</button>
                            <button class="button" onclick="testNotifications()">ğŸ§ª æ¸¬è©¦é€šçŸ¥</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // èªéŸ³è¼¸å…¥ç›¸é—œè®Šæ•¸
        let recognition = null;
        let isVoiceInputActive = false;
        let voiceText = '';
        
        // éŒ„éŸ³ç›¸é—œè®Šæ•¸
        let mediaRecorder = null;
        let audioChunks = [];
        let isRecording = false;
        let isPaused = false;
        let recordingTime = 0;
        let timerInterval = null;
        let accumulatedTime = 0;
        let audioFiles = [];
        let selectedFiles = new Set();
        
        // èªéŸ³è¼¸å…¥åŠŸèƒ½
        function startVoiceInput() {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                alert('æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³è­˜åˆ¥åŠŸèƒ½');
                return;
            }
            
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            
            recognition.continuous = false;
            recognition.interimResults = true;
            recognition.lang = 'zh-TW';
            
            recognition.onstart = () => {
                isVoiceInputActive = true;
                voiceText = '';
                updateVoiceStatus('æ­£åœ¨è†è½...', 'recording');
                document.getElementById('startVoiceBtn').classList.add('hidden');
                document.getElementById('stopVoiceBtn').classList.remove('hidden');
            };
            
            recognition.onresult = (event) => {
                let finalTranscript = '';
                let interimTranscript = '';
                
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const transcript = event.results[i][0].transcript;
                    if (event.results[i].isFinal) {
                        finalTranscript += transcript;
                    } else {
                        interimTranscript += transcript;
                    }
                }
                
                voiceText += finalTranscript;
                document.getElementById('voiceInput').value = voiceText + interimTranscript;
            };
            
            recognition.onerror = (event) => {
                console.error('èªéŸ³è­˜åˆ¥éŒ¯èª¤:', event.error);
                updateVoiceStatus('èªéŸ³è­˜åˆ¥éŒ¯èª¤: ' + event.error, 'error');
                stopVoiceInput();
            };
            
            recognition.onend = () => {
                isVoiceInputActive = false;
                updateVoiceStatus('èªéŸ³è¼¸å…¥å®Œæˆ', 'ready');
                document.getElementById('startVoiceBtn').classList.remove('hidden');
                document.getElementById('stopVoiceBtn').classList.add('hidden');
                if (voiceText.trim()) {
                    document.getElementById('useVoiceTextBtn').classList.remove('hidden');
                }
            };
            
            recognition.start();
        }
        
        function stopVoiceInput() {
            if (recognition) {
                recognition.stop();
            }
        }
        
        function useVoiceText() {
            const text = document.getElementById('voiceInput').value.trim();
            if (text) {
                processTask(text);
                document.getElementById('useVoiceTextBtn').classList.add('hidden');
                document.getElementById('voiceInput').value = '';
                voiceText = '';
            }
        }
        
        function updateVoiceStatus(message, type) {
            const status = document.getElementById('voiceStatus');
            status.textContent = message;
            status.className = `status ${type}`;
        }
        
        // éŒ„éŸ³åŠŸèƒ½
        async function startRecording() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    audio: {
                        echoCancellation: true,
                        noiseSuppression: true,
                        sampleRate: 44100
                    } 
                });
                
                mediaRecorder = new MediaRecorder(stream, {
                    mimeType: 'audio/webm;codecs=opus'
                });
                
                audioChunks = [];
                
                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        audioChunks.push(event.data);
                    }
                };
                
                mediaRecorder.onstop = () => {
                    const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                    const duration = accumulatedTime;
                    const timestamp = new Date();
                    
                    const newFile = {
                        id: `recording_${timestamp.getTime()}`,
                        name: `éŒ„éŸ³æª”æ¡ˆ_${audioFiles.length + 1}_${formatTime(duration)}`,
                        blob: audioBlob,
                        duration: duration,
                        timestamp: timestamp
                    };
                    
                    audioFiles.push(newFile);
                    updateFileList();
                    stream.getTracks().forEach(track => track.stop());
                    accumulatedTime = 0;
                };
                
                mediaRecorder.onpause = () => {
                    isPaused = true;
                    if (timerInterval) clearInterval(timerInterval);
                };
                
                mediaRecorder.onresume = () => {
                    isPaused = false;
                    startTimer();
                };
                
                mediaRecorder.start(1000);
                isRecording = true;
                isPaused = false;
                recordingTime = 0;
                accumulatedTime = 0;
                
                updateRecordingStatus('æ­£åœ¨éŒ„éŸ³...', 'recording');
                document.getElementById('startRecordBtn').classList.add('hidden');
                document.getElementById('pauseRecordBtn').classList.remove('hidden');
                document.getElementById('stopRecordBtn').classList.remove('hidden');
                document.getElementById('timer').classList.remove('hidden');
                
                startTimer();
                
            } catch (error) {
                console.error('ç„¡æ³•è¨ªå•éº¥å…‹é¢¨:', error);
                alert('ç„¡æ³•è¨ªå•éº¥å…‹é¢¨ï¼Œè«‹æª¢æŸ¥ç€è¦½å™¨æ¬Šé™è¨­å®šã€‚');
            }
        }
        
        function pauseRecording() {
            if (mediaRecorder && isRecording && !isPaused) {
                mediaRecorder.pause();
                updateRecordingStatus('éŒ„éŸ³å·²æš«åœ', 'processing');
                document.getElementById('pauseRecordBtn').classList.add('hidden');
                document.getElementById('resumeRecordBtn').classList.remove('hidden');
            }
        }
        
        function resumeRecording() {
            if (mediaRecorder && isRecording && isPaused) {
                mediaRecorder.resume();
                updateRecordingStatus('æ­£åœ¨éŒ„éŸ³...', 'recording');
                document.getElementById('resumeRecordBtn').classList.add('hidden');
                document.getElementById('pauseRecordBtn').classList.remove('hidden');
            }
        }
        
        function stopRecording() {
            if (mediaRecorder && isRecording) {
                mediaRecorder.stop();
                isRecording = false;
                isPaused = false;
                if (timerInterval) {
                    clearInterval(timerInterval);
                    timerInterval = null;
                }
                
                updateRecordingStatus('éŒ„éŸ³å®Œæˆ', 'ready');
                // é‡ç½®æ‰€æœ‰æŒ‰éµç‹€æ…‹
                document.getElementById('startRecordBtn').classList.remove('hidden');
                document.getElementById('pauseRecordBtn').classList.add('hidden');
                document.getElementById('resumeRecordBtn').classList.add('hidden');
                document.getElementById('stopRecordBtn').classList.add('hidden');
                document.getElementById('timer').classList.add('hidden');
            }
        }
        
        function startTimer() {
            timerInterval = setInterval(() => {
                recordingTime++;
                accumulatedTime = recordingTime;
                document.getElementById('timer').textContent = formatTime(recordingTime);
                
                // æ¯10åˆ†é˜è‡ªå‹•æ›æª”
                if (recordingTime > 0 && recordingTime % 600 === 0) {
                    console.log('è‡ªå‹•æ›æª”ï¼šåœæ­¢ç•¶å‰éŒ„éŸ³ä¸¦é–‹å§‹æ–°éŒ„éŸ³');
                    stopRecording();
                    setTimeout(() => {
                        startRecording();
                    }, 1000);
                }
            }, 1000);
        }
        
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        function updateRecordingStatus(message, type) {
            const status = document.getElementById('recordingStatus');
            status.textContent = message;
            status.className = `status ${type}`;
        }
        
        function updateFileList() {
            const container = document.getElementById('filesContainer');
            const fileList = document.getElementById('fileList');
            
            if (audioFiles.length > 0) {
                fileList.classList.remove('hidden');
                container.innerHTML = '';
                
                audioFiles.forEach(file => {
                    const fileItem = document.createElement('div');
                    fileItem.className = 'file-item';
                    fileItem.innerHTML = `
                        <div class="file-info">
                            <div class="file-name">${file.name}</div>
                            <div class="file-details">
                                æ™‚é•·: ${formatTime(file.duration)} | 
                                å¤§å°: ${(file.blob.size / 1024 / 1024).toFixed(2)} MB | 
                                æ™‚é–“: ${file.timestamp.toLocaleString()}
                            </div>
                        </div>
                        <div class="file-actions">
                            <input type="checkbox" ${selectedFiles.has(file.id) ? 'checked' : ''} 
                                   onchange="toggleFileSelection('${file.id}')">
                            <button class="button btn-small" onclick="downloadFile('${file.id}')">ğŸ’¾</button>
                            <button class="button btn-small" onclick="deleteFile('${file.id}')">ğŸ—‘ï¸</button>
                        </div>
                    `;
                    container.appendChild(fileItem);
                });
            } else {
                fileList.classList.add('hidden');
            }
        }
        
        function toggleFileSelection(fileId) {
            if (selectedFiles.has(fileId)) {
                selectedFiles.delete(fileId);
            } else {
                selectedFiles.add(fileId);
            }
        }
        
        function selectAllFiles() {
            selectedFiles.clear();
            audioFiles.forEach(file => selectedFiles.add(file.id));
            updateFileList();
        }
        
        function clearSelection() {
            selectedFiles.clear();
            updateFileList();
        }
        
        function downloadFile(fileId) {
            const file = audioFiles.find(f => f.id === fileId);
            if (file) {
                try {
                    const url = URL.createObjectURL(file.blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${file.name}.webm`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
                    showSuccessMessage('âœ… éŒ„éŸ³æª”æ¡ˆå·²æˆåŠŸä¸‹è¼‰ï¼', `æª”æ¡ˆ "${file.name}" å·²å„²å­˜è‡³æ‚¨çš„ä¸‹è¼‰è³‡æ–™å¤¾`);
                } catch (error) {
                    console.error('ä¸‹è¼‰éŒ¯èª¤:', error);
                    showErrorMessage('âŒ ä¸‹è¼‰å¤±æ•—', 'ç„¡æ³•ä¸‹è¼‰éŒ„éŸ³æª”æ¡ˆï¼š' + error.message);
                }
            }
        }
        
        function deleteFile(fileId) {
            if (confirm('ç¢ºå®šè¦åˆªé™¤æ­¤æª”æ¡ˆå—ï¼Ÿ')) {
                audioFiles = audioFiles.filter(f => f.id !== fileId);
                selectedFiles.delete(fileId);
                updateFileList();
            }
        }
        
        async function transcribeSelected() {
            if (selectedFiles.size === 0) {
                alert('è«‹å…ˆé¸æ“‡è¦è½‰éŒ„çš„æª”æ¡ˆ');
                return;
            }
            
            const selectedAudioFiles = audioFiles.filter(file => selectedFiles.has(file.id));
            let allTranscriptions = [];
            
            document.getElementById('transcriptionSection').classList.remove('hidden');
            document.getElementById('transcriptionText').textContent = 'æ­£åœ¨è½‰éŒ„ä¸­ï¼Œè«‹ç¨å€™...';
            
            try {
                for (const file of selectedAudioFiles) {
                    const formData = new FormData();
                    formData.append('audio', file.blob, `${file.name}.webm`);
                    formData.append('mimeType', 'audio/webm');
                    formData.append('languageCode', 'zh-TW');
                    
                    // é€™è£¡æ‡‰è©²èª¿ç”¨å¾Œç«¯ APIï¼Œæš«æ™‚ä½¿ç”¨æ¨¡æ“¬
                    await new Promise(resolve => setTimeout(resolve, 2000)); // æ¨¡æ“¬è½‰éŒ„æ™‚é–“
                    
                    const mockTranscription = `ã€${file.name}ã€‘\né€™æ˜¯æ¨¡æ“¬çš„è½‰éŒ„çµæœã€‚å¯¦éš›æ‡‰ç”¨ä¸­æœƒèª¿ç”¨ Google Cloud Speech-to-Text API é€²è¡Œè½‰éŒ„ã€‚\n\n`;
                    allTranscriptions.push(mockTranscription);
                }
                
                const combinedTranscription = allTranscriptions.join('---\n\n');
                document.getElementById('transcriptionText').textContent = combinedTranscription;
                
                // æ¸…é™¤å·²è½‰éŒ„çš„æª”æ¡ˆ
                audioFiles = audioFiles.filter(file => !selectedFiles.has(file.id));
                selectedFiles.clear();
                updateFileList();
                
            } catch (error) {
                console.error('è½‰éŒ„éŒ¯èª¤:', error);
                alert('è½‰éŒ„å¤±æ•—: ' + error.message);
            }
        }
        
        function useTranscription() {
            const transcription = document.getElementById('transcriptionText').textContent;
            if (transcription.trim()) {
                processTask(transcription);
            }
        }
        
        function clearTranscription() {
            document.getElementById('transcriptionText').textContent = 'è½‰é€å­—ç¨¿çµæœå°‡é¡¯ç¤ºåœ¨æ­¤è™•...';
            document.getElementById('transcriptionSection').classList.add('hidden');
        }
        
        function downloadTranscription() {
            const transcription = document.getElementById('transcriptionText').textContent;
            if (transcription.trim() && transcription !== 'è½‰é€å­—ç¨¿çµæœå°‡é¡¯ç¤ºåœ¨æ­¤è™•...') {
                try {
                    const blob = new Blob([transcription], { type: 'text/plain;charset=utf-8' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `é€å­—ç¨¿_${new Date().toISOString().split('T')[0]}.txt`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
                    showSuccessMessage('âœ… é€å­—ç¨¿æª”æ¡ˆå·²æˆåŠŸä¸‹è¼‰ï¼', 'é€å­—ç¨¿å·²å„²å­˜è‡³æ‚¨çš„ä¸‹è¼‰è³‡æ–™å¤¾');
                } catch (error) {
                    console.error('ä¸‹è¼‰éŒ¯èª¤:', error);
                    showErrorMessage('âŒ ä¸‹è¼‰å¤±æ•—', 'ç„¡æ³•ä¸‹è¼‰é€å­—ç¨¿æª”æ¡ˆï¼š' + error.message);
                }
            } else {
                showErrorMessage('âŒ ä¸‹è¼‰å¤±æ•—', 'æ²’æœ‰é€å­—ç¨¿å…§å®¹å¯ä¸‹è¼‰');
            }
        }
        
        // ä»»å‹™è™•ç†
        async function processTask(text) {
            if (!text.trim()) {
                alert('è«‹è¼¸å…¥ä»»å‹™æè¿°');
                return;
            }
            
            // é¡¯ç¤ºè™•ç†ä¸­ç‹€æ…‹
            const resultDiv = document.getElementById('taskResult');
            const contentDiv = document.getElementById('taskContent');
            resultDiv.classList.remove('hidden');
            contentDiv.innerHTML = '<div class="status processing">ğŸ”„ æ­£åœ¨ä½¿ç”¨ Gemini 2.5 Flash åˆ†æä»»å‹™...</div>';
            
            try {
                // èª¿ç”¨å¾Œç«¯ API é€²è¡Œ AI åˆ†æ
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        text: text,
                        timestamp: new Date().toISOString()
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                displayTaskResult(result);
                
            } catch (error) {
                console.error('AI åˆ†æéŒ¯èª¤:', error);
                
                // é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯ï¼Œä¸ä½¿ç”¨æ¨¡æ“¬çµæœ
                contentDiv.innerHTML = `
                    <div class="status error">
                        <h4>âŒ AI åˆ†æå¤±æ•—</h4>
                        <p><strong>éŒ¯èª¤åŸå› ï¼š</strong> ${error.message}</p>
                        <p><strong>å¯èƒ½åŸå› ï¼š</strong></p>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>å¾Œç«¯æœå‹™æœªå•Ÿå‹•æˆ–ç„¡æ³•é€£æ¥</li>
                            <li>Gemini API é‡‘é‘°æœªè¨­å®šæˆ–ç„¡æ•ˆ</li>
                            <li>ç¶²è·¯é€£æ¥å•é¡Œ</li>
                            <li>å¾Œç«¯ API ç«¯é»éŒ¯èª¤</li>
                        </ul>
                        <p><strong>å»ºè­°è§£æ±ºæ–¹æ¡ˆï¼š</strong></p>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>æª¢æŸ¥å¾Œç«¯æœå‹™æ˜¯å¦æ­£å¸¸é‹è¡Œ</li>
                            <li>ç¢ºèª Gemini API é‡‘é‘°è¨­å®šæ­£ç¢º</li>
                            <li>æª¢æŸ¥ç¶²è·¯é€£æ¥ç‹€æ…‹</li>
                            <li>è¯ç¹«ç³»çµ±ç®¡ç†å“¡</li>
                        </ul>
                    </div>
                `;
            }
        }
        
        function displayTaskResult(result) {
            const resultDiv = document.getElementById('taskResult');
            const contentDiv = document.getElementById('taskContent');
            const dispatchSection = document.getElementById('dispatchSection');
            
            let html = '<div style="background: #e9ecef; padding: 20px; border-radius: 8px; margin: 15px 0;">';
            html += '<h4>ğŸ“‹ ä»»å‹™åˆ—è¡¨</h4>';
            result.tasks.forEach((task, index) => {
                html += `<div style="background: white; padding: 15px; margin: 10px 0; border-left: 4px solid #4facfe; border-radius: 5px;">`;
                html += `<strong>${task.title}</strong><br>`;
                html += `<small style="color: #666;">å„ªå…ˆç´š: ${task.priority} | è² è²¬äºº: ${task.assignee} | ç‹€æ…‹: ${task.status}</small>`;
                html += `<p style="margin-top: 10px;">${task.description}</p>`;
                html += `</div>`;
            });
            html += '</div>';
            
            html += '<div style="background: #d4edda; padding: 15px; border-radius: 8px; margin: 15px 0;">';
            html += '<h4>ğŸ“ æ‘˜è¦</h4>';
            html += `<p>${result.summary}</p>`;
            html += '</div>';
            
            contentDiv.innerHTML = html;
            resultDiv.classList.remove('hidden');
            dispatchSection.classList.remove('hidden');
            
            // å„²å­˜ä»»å‹™çµæœä¾›å¾ŒçºŒä½¿ç”¨
            window.currentTaskResult = result;
        }
        
        // ä»»å‹™æ´¾é£åŠŸèƒ½
        async function dispatchTasks() {
            if (!window.currentTaskResult) {
                alert('æ²’æœ‰å¯æ´¾é£çš„ä»»å‹™');
                return;
            }
            
            const statusDiv = document.getElementById('backendStatus');
            const statusList = document.getElementById('statusList');
            
            statusDiv.classList.remove('hidden');
            statusList.innerHTML = '<div class="status-item">ğŸ”„ æ­£åœ¨æ´¾é£ä»»å‹™è‡³å¾Œç«¯ç³»çµ±...</div>';
            
            try {
                const response = await fetch('/api/dispatch', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        tasks: window.currentTaskResult.tasks,
                        summary: window.currentTaskResult.summary
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                
                // é¡¯ç¤ºæ´¾é£çµæœ
                statusList.innerHTML = `
                    <div class="status-item">âœ… Firestore: ${result.firestore || 'ä»»å‹™å·²å„²å­˜è‡³ Firestore'}</div>
                    <div class="status-item">âœ… Google Sheets: ${result.sheets || 'ä»»å‹™å·²æ–°å¢è‡³ Google Sheets'}</div>
                    <div class="status-item">âœ… Google Docs: ${result.docs || 'ä»»å‹™æ–‡ä»¶å·²å»ºç«‹'}</div>
                    <div class="status-item">â³ é€šçŸ¥: ç­‰å¾…æ‰‹å‹•è§¸ç™¼è² è²¬äººé€šçŸ¥</div>
                `;
                
            } catch (error) {
                console.error('ä»»å‹™æ´¾é£éŒ¯èª¤:', error);
                statusList.innerHTML = `
                    <div class="status-item error">
                        <h4>âŒ ä»»å‹™æ´¾é£å¤±æ•—</h4>
                        <p><strong>éŒ¯èª¤åŸå› ï¼š</strong> ${error.message}</p>
                        <p><strong>å¯èƒ½åŸå› ï¼š</strong></p>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>å¾Œç«¯æœå‹™æœªå•Ÿå‹•æˆ–ç„¡æ³•é€£æ¥</li>
                            <li>Firestore é€£æ¥å•é¡Œ</li>
                            <li>Google Sheets API è¨­å®šéŒ¯èª¤</li>
                            <li>Google Docs API æ¬Šé™å•é¡Œ</li>
                        </ul>
                        <p><strong>å»ºè­°è§£æ±ºæ–¹æ¡ˆï¼š</strong></p>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>æª¢æŸ¥å¾Œç«¯æœå‹™ç‹€æ…‹</li>
                            <li>ç¢ºèª Google Cloud æœå‹™è¨­å®š</li>
                            <li>æª¢æŸ¥ API é‡‘é‘°å’Œæ¬Šé™</li>
                            <li>è¯ç¹«ç³»çµ±ç®¡ç†å“¡</li>
                        </ul>
                    </div>
                `;
            }
        }
        
        // ç™¼é€é€šçŸ¥åŠŸèƒ½
        async function sendNotifications() {
            if (!window.currentTaskResult) {
                alert('æ²’æœ‰å¯é€šçŸ¥çš„ä»»å‹™');
                return;
            }
            
            const statusList = document.getElementById('statusList');
            statusList.innerHTML += '<div class="status-item">ğŸ“§ æ­£åœ¨ç™¼é€é€šçŸ¥çµ¦è² è²¬äºº...</div>';
            
            try {
                // æ”¶é›†è² è²¬äººé€šçŸ¥è³‡è¨Š
                const notifications = [];
                const assignees = ['emily', 'benjamin', 'chloe', 'daniel', 'olivia'];
                
                assignees.forEach(assignee => {
                    const gmail = document.getElementById(`${assignee}-gmail`).value;
                    const lineId = document.getElementById(`${assignee}-line`).value;
                    
                    if (gmail || lineId) {
                        notifications.push({
                            assignee: assignee,
                            gmail: gmail,
                            lineId: lineId,
                            tasks: window.currentTaskResult.tasks.filter(task => 
                                task.assignee.toLowerCase().includes(assignee)
                            )
                        });
                    }
                });
                
                if (notifications.length === 0) {
                    alert('è«‹å…ˆè¨­å®šè² è²¬äººçš„è¯çµ¡è³‡è¨Š');
                    return;
                }
                
                const response = await fetch('/api/notify', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        notifications: notifications
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                statusList.innerHTML += '<div class="status-item">âœ… é€šçŸ¥å·²ç™¼é€: ' + result.message + '</div>';
                
            } catch (error) {
                console.error('é€šçŸ¥ç™¼é€éŒ¯èª¤:', error);
                statusList.innerHTML += `
                    <div class="status-item error">
                        <h4>âŒ é€šçŸ¥ç™¼é€å¤±æ•—</h4>
                        <p><strong>éŒ¯èª¤åŸå› ï¼š</strong> ${error.message}</p>
                        <p><strong>å¯èƒ½åŸå› ï¼š</strong></p>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>Gmail API è¨­å®šéŒ¯èª¤æˆ–æ¬Šé™ä¸è¶³</li>
                            <li>Line Notify API é‡‘é‘°ç„¡æ•ˆ</li>
                            <li>è² è²¬äººè¯çµ¡è³‡è¨Šè¨­å®šéŒ¯èª¤</li>
                            <li>ç¶²è·¯é€£æ¥å•é¡Œ</li>
                        </ul>
                        <p><strong>å»ºè­°è§£æ±ºæ–¹æ¡ˆï¼š</strong></p>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>æª¢æŸ¥ Gmail å’Œ Line API è¨­å®š</li>
                            <li>ç¢ºèªè² è²¬äººè¯çµ¡è³‡è¨Šæ­£ç¢º</li>
                            <li>æª¢æŸ¥ç¶²è·¯é€£æ¥ç‹€æ…‹</li>
                            <li>è¯ç¹«ç³»çµ±ç®¡ç†å“¡</li>
                        </ul>
                    </div>
                `;
            }
        }
        
        // æŸ¥çœ‹ä»»å‹™ç‹€æ…‹
        function viewTaskStatus() {
            const statusDiv = document.getElementById('backendStatus');
            const statusList = document.getElementById('statusList');
            
            statusDiv.classList.remove('hidden');
            statusList.innerHTML = `
                <div class="status-item">ğŸ“Š ä»»å‹™ç‹€æ…‹ç¸½è¦½</div>
                <div class="status-item">ğŸ“‹ ç¸½ä»»å‹™æ•¸: ${window.currentTaskResult?.tasks?.length || 0}</div>
                <div class="status-item">ğŸ‘¥ æ¶‰åŠè² è²¬äºº: ${getUniqueAssignees()}</div>
                <div class="status-item">â° å»ºç«‹æ™‚é–“: ${new Date().toLocaleString()}</div>
            `;
        }
        
        function getUniqueAssignees() {
            if (!window.currentTaskResult?.tasks) return 'ç„¡';
            const assignees = [...new Set(window.currentTaskResult.tasks.map(task => task.assignee))];
            return assignees.join(', ');
        }
        
        // å„²å­˜é€šçŸ¥è¨­å®š
        function saveNotificationSettings() {
            const settings = {};
            const assignees = ['emily', 'benjamin', 'chloe', 'daniel', 'olivia'];
            
            assignees.forEach(assignee => {
                settings[assignee] = {
                    gmail: document.getElementById(`${assignee}-gmail`).value,
                    lineId: document.getElementById(`${assignee}-line`).value
                };
            });
            
            localStorage.setItem('notificationSettings', JSON.stringify(settings));
            alert('é€šçŸ¥è¨­å®šå·²å„²å­˜ï¼');
        }
        
        // è¼‰å…¥é€šçŸ¥è¨­å®š
        function loadNotificationSettings() {
            const settings = JSON.parse(localStorage.getItem('notificationSettings') || '{}');
            const assignees = ['emily', 'benjamin', 'chloe', 'daniel', 'olivia'];
            
            assignees.forEach(assignee => {
                if (settings[assignee]) {
                    document.getElementById(`${assignee}-gmail`).value = settings[assignee].gmail || '';
                    document.getElementById(`${assignee}-line`).value = settings[assignee].lineId || '';
                }
            });
        }
        
        // æ¸¬è©¦é€šçŸ¥
        async function testNotifications() {
            const assignees = ['emily', 'benjamin', 'chloe', 'daniel', 'olivia'];
            let hasSettings = false;
            
            assignees.forEach(assignee => {
                const gmail = document.getElementById(`${assignee}-gmail`).value;
                const lineId = document.getElementById(`${assignee}-line`).value;
                if (gmail || lineId) hasSettings = true;
            });
            
            if (!hasSettings) {
                alert('è«‹å…ˆè¨­å®šè‡³å°‘ä¸€å€‹è² è²¬äººçš„è¯çµ¡è³‡è¨Š');
                return;
            }
            
            try {
                const response = await fetch('/api/test-notify', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: 'é€™æ˜¯ä¸€å€‹æ¸¬è©¦é€šçŸ¥ï¼Œç”¨æ–¼é©—è­‰é€šçŸ¥ç³»çµ±æ˜¯å¦æ­£å¸¸é‹ä½œã€‚'
                    })
                });
                
                if (response.ok) {
                    alert('æ¸¬è©¦é€šçŸ¥å·²ç™¼é€ï¼è«‹æª¢æŸ¥è² è²¬äººçš„ Gmail å’Œ Lineã€‚');
                } else {
                    throw new Error('æ¸¬è©¦é€šçŸ¥ç™¼é€å¤±æ•—');
                }
                
            } catch (error) {
                console.error('æ¸¬è©¦é€šçŸ¥éŒ¯èª¤:', error);
                alert('æ¸¬è©¦é€šçŸ¥ç™¼é€å¤±æ•—: ' + error.message);
            }
        }
        
        // è¼¸å…¥æ–¹å¼åˆ‡æ›
        function switchInputMethod(method) {
            // éš±è—æ‰€æœ‰è¼¸å…¥å€åŸŸ
            document.querySelectorAll('.input-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰æŒ‰éµçš„ active ç‹€æ…‹
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // é¡¯ç¤ºé¸ä¸­çš„è¼¸å…¥å€åŸŸ
            document.getElementById(method + '-input').classList.add('active');
            
            // è¨­å®šæŒ‰éµç‚º active ç‹€æ…‹
            event.target.classList.add('active');
        }
        
        // æ‰‹å‹•è¼¸å…¥åŠŸèƒ½
        function processManualInput() {
            const text = document.getElementById('manualInput').value.trim();
            if (text) {
                processTask(text);
            } else {
                alert('è«‹è¼¸å…¥ä»»å‹™æè¿°');
            }
        }
        
        function clearManualInput() {
            document.getElementById('manualInput').value = '';
        }
        
        // è¢å¹•æˆªåœ–åŠŸèƒ½
        function startScreenshot() {
            // é€™è£¡å¯ä»¥æ•´åˆç¬¬ä¸‰æ–¹æˆªåœ–å·¥å…·æˆ–ç€è¦½å™¨ API
            alert('è¢å¹•æˆªåœ–åŠŸèƒ½éœ€è¦æ•´åˆç¬¬ä¸‰æ–¹å·¥å…·æˆ–ç€è¦½å™¨æ“´å±•ã€‚\n\nå»ºè­°ä½¿ç”¨ï¼š\n1. ç€è¦½å™¨æˆªåœ–æ“´å±•\n2. ç³»çµ±æˆªåœ–å·¥å…·\n3. æ‹–æ‹½åœ–ç‰‡åˆ°æ­¤å€åŸŸ');
        }
        
        function handleScreenshotDrop(event) {
            event.preventDefault();
            const files = event.dataTransfer.files;
            if (files.length > 0) {
                handleScreenshotFile(files[0]);
            }
        }
        
        function handleDragOver(event) {
            event.preventDefault();
        }
        
        function handleScreenshotFile(file) {
            if (file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('screenshotImage').src = e.target.result;
                    document.getElementById('screenshotPreview').classList.remove('hidden');
                    document.getElementById('screenshotPlaceholder').classList.add('hidden');
                };
                reader.readAsDataURL(file);
            } else {
                alert('è«‹é¸æ“‡åœ–ç‰‡æª”æ¡ˆ');
            }
        }
        
        function analyzeScreenshot() {
            const img = document.getElementById('screenshotImage');
            if (img.src) {
                // é€™è£¡å¯ä»¥æ•´åˆ OCR æˆ–åœ–åƒåˆ†æ API
                const mockAnalysis = 'ã€æˆªåœ–åˆ†æã€‘\né€™æ˜¯ä¸€å€‹æ¨¡æ“¬çš„æˆªåœ–åˆ†æçµæœã€‚å¯¦éš›æ‡‰ç”¨ä¸­æœƒä½¿ç”¨ OCR æŠ€è¡“æå–åœ–ç‰‡ä¸­çš„æ–‡å­—å…§å®¹ã€‚';
                processTask(mockAnalysis);
            } else {
                alert('è«‹å…ˆä¸Šå‚³æˆªåœ–');
            }
        }
        
        function clearScreenshot() {
            document.getElementById('screenshotPreview').classList.add('hidden');
            document.getElementById('screenshotPlaceholder').classList.remove('hidden');
            document.getElementById('screenshotImage').src = '';
        }
        
        // æª”æ¡ˆä¸Šå‚³åŠŸèƒ½
        function handleFileDrop(event) {
            event.preventDefault();
            const files = event.dataTransfer.files;
            handleFiles(files);
        }
        
        function handleFileSelect(event) {
            const files = event.target.files;
            handleFiles(files);
        }
        
        function handleFiles(files) {
            const uploadedFiles = document.getElementById('uploadedFiles');
            const filesList = document.getElementById('filesList');
            
            uploadedFiles.classList.remove('hidden');
            filesList.innerHTML = '';
            
            Array.from(files).forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <div class="file-info">
                        <div class="file-name">${file.name}</div>
                        <div class="file-details">
                            å¤§å°: ${(file.size / 1024 / 1024).toFixed(2)} MB | 
                            é¡å‹: ${file.type || 'æœªçŸ¥'}
                        </div>
                    </div>
                    <div class="file-actions">
                        <button class="button btn-small" onclick="removeFile(${index})">ğŸ—‘ï¸</button>
                    </div>
                `;
                filesList.appendChild(fileItem);
            });
        }
        
        function removeFile(index) {
            // ç§»é™¤æª”æ¡ˆé‚è¼¯
            const filesList = document.getElementById('filesList');
            const fileItems = filesList.querySelectorAll('.file-item');
            if (fileItems[index]) {
                fileItems[index].remove();
            }
        }
        
        function analyzeUploadedFiles() {
            const filesList = document.getElementById('filesList');
            const fileItems = filesList.querySelectorAll('.file-item');
            if (fileItems.length > 0) {
                // é€™è£¡å¯ä»¥æ•´åˆæª”æ¡ˆè§£æ API
                const mockAnalysis = 'ã€æª”æ¡ˆåˆ†æã€‘\né€™æ˜¯æ¨¡æ“¬çš„æª”æ¡ˆåˆ†æçµæœã€‚å¯¦éš›æ‡‰ç”¨ä¸­æœƒè§£æ Wordã€PDFã€JSONã€Markdown ç­‰æª”æ¡ˆå…§å®¹ã€‚';
                processTask(mockAnalysis);
            } else {
                alert('è«‹å…ˆä¸Šå‚³æª”æ¡ˆ');
            }
        }
        
        function clearUploadedFiles() {
            document.getElementById('uploadedFiles').classList.add('hidden');
            document.getElementById('filesList').innerHTML = '';
        }
        
        // é›²ç«¯æª”æ¡ˆåŠŸèƒ½
        function fetchCloudDocument() {
            const url = document.getElementById('cloudUrl').value.trim();
            if (url) {
                // é€™è£¡å¯ä»¥æ•´åˆ Google Docs API æˆ–å…¶ä»–é›²ç«¯æœå‹™
                const mockContent = 'ã€é›²ç«¯æª”æ¡ˆå…§å®¹ã€‘\né€™æ˜¯æ¨¡æ“¬çš„é›²ç«¯æª”æ¡ˆå…§å®¹ã€‚å¯¦éš›æ‡‰ç”¨ä¸­æœƒé€šé API ç²å– Google Docs æˆ–å…¶ä»–é›²ç«¯æœå‹™çš„æª”æ¡ˆå…§å®¹ã€‚';
                
                document.getElementById('cloudContent').textContent = mockContent;
                document.getElementById('cloudPreview').classList.remove('hidden');
            } else {
                alert('è«‹è¼¸å…¥é›²ç«¯æª”æ¡ˆé€£çµ');
            }
        }
        
        function analyzeCloudDocument() {
            const content = document.getElementById('cloudContent').textContent;
            if (content) {
                processTask(content);
            } else {
                alert('è«‹å…ˆè¼‰å…¥é›²ç«¯æª”æ¡ˆ');
            }
        }
        
        function clearCloudInput() {
            document.getElementById('cloudUrl').value = '';
            document.getElementById('cloudPreview').classList.add('hidden');
        }
        
        // æ–‡å­—è²¼æ–‡åŠŸèƒ½
        function processTextInput() {
            const text = document.getElementById('textInput').value.trim();
            if (text) {
                processTask(text);
            } else {
                alert('è«‹è²¼ä¸Šæ–‡å­—å…§å®¹');
            }
        }
        
        function clearTextInput() {
            document.getElementById('textInput').value = '';
        }
        
        // åˆå§‹åŒ–
        console.log('AI ä»»å‹™æ´¾é£ä¸­å¿ƒ - å¤šç¨®è¼¸å…¥æ–¹å¼ç‰ˆè¼‰å…¥æˆåŠŸ');
        
        // æˆåŠŸè¨Šæ¯é¡¯ç¤º
        function showSuccessMessage(title, message) {
            const notification = document.createElement('div');
            notification.className = 'notification success';
            notification.innerHTML = `
                <div style="background: #d4edda; border: 1px solid #c3e6cb; color: #155724; padding: 15px; border-radius: 8px; margin: 10px 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <h4 style="margin: 0 0 5px 0; font-size: 16px;">${title}</h4>
                    <p style="margin: 0; font-size: 14px;">${message}</p>
                </div>
            `;
            
            // æ’å…¥åˆ°é é¢é ‚éƒ¨
            const container = document.querySelector('.container');
            container.insertBefore(notification, container.firstChild);
            
            // 3ç§’å¾Œè‡ªå‹•ç§»é™¤
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
        }
        
        // éŒ¯èª¤è¨Šæ¯é¡¯ç¤º
        function showErrorMessage(title, message) {
            const notification = document.createElement('div');
            notification.className = 'notification error';
            notification.innerHTML = `
                <div style="background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; padding: 15px; border-radius: 8px; margin: 10px 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <h4 style="margin: 0 0 5px 0; font-size: 16px;">${title}</h4>
                    <p style="margin: 0; font-size: 14px;">${message}</p>
                </div>
            `;
            
            // æ’å…¥åˆ°é é¢é ‚éƒ¨
            const container = document.querySelector('.container');
            container.insertBefore(notification, container.firstChild);
            
            // 5ç§’å¾Œè‡ªå‹•ç§»é™¤
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 5000);
        }
        
        // è¼‰å…¥é€šçŸ¥è¨­å®š
        document.addEventListener('DOMContentLoaded', function() {
            loadNotificationSettings();
        });
    </script>
</body>
</html>